!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("p5.OffscreenCanvas",[],t):"object"==typeof exports?exports["p5.OffscreenCanvas"]=t():e["p5.OffscreenCanvas"]=t()}(this,(()=>(()=>{p5.prototype.createOffscreenCanvas=function(t,n,s){if("undefined"==typeof OffscreenCanvas)throw new Error("OffscreenCanvas is not supported by this browser!");return new e(t,n,s,this)},p5.Renderer2D.prototype.image=function(e,t,n,s,i,r,a,h,d){let o;e.gifProperties&&e._animateGif(this._pInst);try{p5.MediaElement&&e instanceof p5.MediaElement&&e._ensureCanvas(),this._tint&&e.canvas&&(o=this._getTintedImageCanvas(e)),o||(o=e.canvas||e.elt),e instanceof ImageBitmap&&(o=e),e instanceof OffscreenCanvas&&(o=e);let p=1;e.width&&e.width>0&&(p=e instanceof ImageBitmap||e instanceof OffscreenCanvas?this._pInst._pixelDensity:o.width/e.width),this._isErasing&&this.blendMode(this._cachedBlendMode),this.drawingContext.drawImage(o,p*t,p*n,p*s,p*i,r,a,h,d),this._isErasing&&this._pInst.erase()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e}};class e{constructor(e,t,n,s){const i=n||s.P2D;this.r=i,this._pInst=s,this.canvas=new OffscreenCanvas(e,t),this.canvas.context=this.canvas.getContext(i===s.WEBGL?"webgl":"2d"),this.canvas.style={};for(const e in p5.prototype)this[e]||("function"==typeof p5.prototype[e]?this[e]=p5.prototype[e].bind(this):this[e]=p5.prototype[e]);return p5.prototype._initializeInstanceVariables.apply(this),this.width=e,this.height=t,this._pixelDensity=s._pixelDensity,i===s.WEBGL?this._renderer=new p5.RendererGL(this.canvas,s,!1):this._renderer=new p5.Renderer2D(this.canvas,s,!1),s._elements.push(this),Object.defineProperty(this,"deltaTime",{get:function(){return this._pInst.deltaTime}}),this._renderer.resize(e,t),this._renderer._applyDefaults(),this}reset(){this._renderer.resetMatrix(),this._renderer.isP3D&&this._renderer._update()}remove(){const e=this._pInst._elements.indexOf(this);-1!==e&&this._pInst._elements.splice(e,1)}currentFrame(){return this.canvas.transferToImageBitmap()}currentBlob(e,t){if(!t)return this.canvas.convertToBlob(e);this.canvas.convertToBlob(e).then(t)}currentCanvas(){return this.canvas}loadCanvas(e){let t;this.canvas=e,this.width=e.width/this._pixelDensity,this.height=e.height/this._pixelDensity,this.canvas.context?this.canvas.context instanceof OffscreenCanvasRenderingContext2D?t=this._pInst.P2D:(this.canvas.context instanceof WebGL2RenderingContext||this.canvas.context instanceof WebGLRenderingContext)&&(t=this._pInst.WEBGL):this.canvas.context=this.canvas.getContext(this.r===this._pInst.WEBGL?"webgl":"2d"),t&&t!==this.r||!t?(this.r=t||this.r,this.r===this._pInst.WEBGL?this._renderer=new p5.RendererGL(this.canvas,this._pInst,!1):this._renderer=new p5.Renderer2D(this.canvas,this._pInst,!1)):t===this._pInst.P2D?(this._renderer._pInst=this._pInst,this._renderer._pixelsState=this._pInst,this._renderer.width=this.canvas.width/this._pixelDensity,this._renderer.height=this.canvas.height/this._pixelDensity,this._renderer.canvas=this.canvas,this._renderer.drawingContext=this.canvas.context,this._renderer._pInst._setProperty("drawingContext",this._renderer.drawingContext)):(this._renderer._pInst=this._pInst,this._renderer._pixelsState=this._pInst,this._renderer.width=this.canvas.width/this._pixelDensity,this._renderer.height=this.canvas.height/this._pixelDensity,this._renderer.drawingContext=this.canvas.context,this._renderer.drawingContext.enable(this._renderer.drawingContext.DEPTH_TEST),this._renderer.drawingContext.depthFunc(this._renderer.drawingContext.LEQUAL),this._renderer.drawingContext.viewport(0,0,this._renderer.drawingContext.drawingBufferWidth,this._renderer.drawingContext.drawingBufferHeight),this._renderer._viewport=this._renderer.drawingContext.getParameter(this._renderer.drawingContext.VIEWPORT),this._renderer.GL=this._renderer.drawingContext,this._renderer._pInst._setProperty("drawingContext",this._renderer.drawingContext))}}return{}})()));